<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Customizer | Big Head Billionaires</title>
  <link rel="icon" href="../assets/favicon.png"/>
  <link rel="stylesheet" href="../assets/bhb.css"/>
  <style>
    .customizer-wrap {
      display: grid;
      grid-template-columns: 260px 1fr 240px;
      height: calc(100vh - 62px);
    }
    @media (max-width: 960px) { .customizer-wrap { grid-template-columns: 1fr; height: auto; } }

    /* ‚îÄ‚îÄ LEFT: Traits ‚îÄ‚îÄ */
    .trait-panel {
      background: var(--white);
      border-right: 3px solid var(--black);
      overflow-y: auto;
    }
    .trait-panel-hd {
      background: var(--black);
      padding: 0.7rem 1.1rem;
      font-family: var(--font-display);
      font-size: 1rem;
      color: var(--yellow);
      letter-spacing: 0.08em;
      position: sticky;
      top: 0;
      z-index: 5;
      border-bottom: 3px solid var(--black);
    }
    .trait-cat { border-bottom: 2px solid var(--black); }
    .trait-cat-hd {
      padding: 0.65rem 1.1rem;
      font-family: var(--font-mono);
      font-size: 0.62rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: #444;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      user-select: none;
      background: #f5f0e8;
      transition: background 0.1s;
    }
    .trait-cat-hd:hover { background: var(--yellow); }
    .trait-cat-hd.open { background: var(--yellow); color: var(--black); }
    .trait-cat-arrow { font-size: 0.7rem; transition: transform 0.2s; }
    .trait-cat-hd.open .trait-cat-arrow { transform: rotate(90deg); }

    .trait-chips { display: none; flex-wrap: wrap; gap: 0.35rem; padding: 0.65rem 0.85rem; }
    .trait-chips.open { display: flex; }

    .trait-chip {
      font-family: var(--font-mono);
      font-size: 0.65rem;
      padding: 0.25rem 0.6rem;
      border-radius: 4px;
      border: 2px solid rgba(0,0,0,0.15);
      background: var(--white);
      color: #555;
      cursor: pointer;
      transition: all 0.1s;
      white-space: nowrap;
    }
    .trait-chip:hover { border-color: var(--black); color: var(--black); background: #fafaf5; }
    .trait-chip.selected { border-color: var(--black); background: var(--yellow); color: var(--black); font-weight: 500; box-shadow: 2px 2px 0 var(--black); }
    .trait-chip.locked { opacity: 0.4; border-style: dashed; cursor: not-allowed; }
    .trait-chip.locked:hover { border-color: var(--orange); color: var(--orange); background: #fff8e8; }

    /* ‚îÄ‚îÄ CENTER: Canvas ‚îÄ‚îÄ */
    .canvas-stage {
      background: var(--bg);
      background-image: radial-gradient(circle, rgba(0,0,0,0.055) 1px, transparent 1px);
      background-size: 18px 18px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      border-right: 3px solid var(--black);
    }
    .canvas-box {
      border: 3px solid var(--black);
      border-radius: 8px;
      overflow: hidden;
      box-shadow: var(--shadow-lg);
      position: relative;
      width: 340px;
      height: 340px;
    }
    .canvas-box canvas { position: absolute; inset: 0; width: 100%; height: 100%; }
    .canvas-label { margin-top: 1rem; font-family: var(--font-display); font-size: 1.1rem; letter-spacing: 0.04em; }

    /* ‚îÄ‚îÄ RIGHT: Save Panel ‚îÄ‚îÄ */
    .save-panel {
      background: var(--white);
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 0;
    }
    .save-panel-hd {
      background: var(--black);
      padding: 0.7rem 1.1rem;
      font-family: var(--font-display);
      font-size: 1rem;
      color: var(--yellow);
      letter-spacing: 0.08em;
      position: sticky;
      top: 0;
      z-index: 5;
      border-bottom: 3px solid var(--black);
    }
    .save-panel-body { padding: 1.1rem; display: flex; flex-direction: column; gap: 1rem; flex: 1; }

    .trait-summary { display: flex; flex-direction: column; gap: 0; }
    .trait-row {
      display: flex; justify-content: space-between;
      font-family: var(--font-mono); font-size: 0.7rem;
      padding: 0.4rem 0; border-bottom: 1px dashed rgba(0,0,0,0.1);
    }
    .trait-row:last-child { border-bottom: none; }
    .trait-row-lbl { color: #888; text-transform: uppercase; letter-spacing: 0.08em; font-size: 0.6rem; }
    .trait-row-val { color: var(--black); font-weight: 500; }
    .trait-row-val.empty { color: #bbb; font-style: italic; font-weight: 400; }

    .save-btn {
      width: 100%;
      padding: 0.85rem;
      border-radius: 6px;
      border: 3px solid var(--black);
      background: var(--yellow);
      color: var(--black);
      font-family: var(--font-display);
      font-size: 1rem;
      letter-spacing: 0.08em;
      cursor: pointer;
      box-shadow: var(--shadow-sm);
      transition: all 0.1s;
    }
    .save-btn:hover { transform: translate(-2px,-2px); box-shadow: 6px 6px 0 var(--black); }
    .save-btn:disabled { background: #ddd; color: #aaa; cursor: not-allowed; transform: none; box-shadow: 3px 3px 0 #bbb; border-color: #bbb; }

    .animator-link {
      display: block;
      width: 100%;
      padding: 0.75rem;
      border-radius: 6px;
      border: 2px solid var(--black);
      background: var(--white);
      color: var(--black);
      font-family: var(--font-display);
      font-size: 0.9rem;
      letter-spacing: 0.06em;
      text-align: center;
      text-decoration: none;
      transition: all 0.1s;
      box-shadow: var(--shadow-sm);
    }
    .animator-link:hover { transform: translate(-1px,-1px); box-shadow: 4px 4px 0 var(--black); background: var(--blue-pale); }

    .save-note { font-family: var(--font-mono); font-size: 0.62rem; color: #aaa; line-height: 1.6; }

    /* ‚îÄ‚îÄ Gate ‚îÄ‚îÄ */
    .gate {
      position: fixed;
      inset: 62px 0 0;
      background: rgba(245,240,232,0.97);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      text-align: center;
      padding: 2rem;
      z-index: 20;
      backdrop-filter: blur(2px);
    }
    .gate-icon { font-size: 5rem; margin-bottom: 1rem; animation: float 4s ease-in-out infinite; }
    .gate h2 { font-family: var(--font-display); font-size: 2rem; margin-bottom: 0.5rem; letter-spacing: 0.04em; }
    .gate p { font-family: var(--font-mono); font-size: 0.8rem; color: #555; max-width: 360px; line-height: 1.7; margin-bottom: 2rem; }
    .gate-links { font-family: var(--font-mono); font-size: 0.72rem; color: #888; margin-top: 0.75rem; }
    .gate-links a { color: var(--red); text-decoration: none; }
  </style>
</head>
<body>

<nav class="bhb-nav">
  <a href="../index.html" class="logo">BIG HEAD <span>BILLIONAIRES</span></a>
  <ul class="nav-links">
    <li><a href="../game/index.html">Play &amp; Mint</a></li>
    <li><a href="../mint/index.html">Mint</a></li>
    <li><a href="../expansions/index.html">Expansions</a></li>
    <li><a href="index.html" class="active">Customizer</a></li>
    <li><a href="../animator/index.html">Animator</a></li>
  </ul>
  <button class="nav-wallet-btn" id="walletBtn">Connect Wallet</button>
</nav>

<main class="page" style="padding-top:62px; position:relative;">

  <!-- Gate -->
  <div class="gate" id="gate">
    <div class="gate-icon">üîê</div>
    <h2>NFT Holders Only</h2>
    <p>Connect your wallet to verify your Big Head Billionaires NFT. Verified holders can customize traits and save them to chain.</p>
    <button class="btn btn-black" onclick="BHB.connectWallet()">Connect Wallet</button>
    <div class="gate-links">
      Don't have one yet? <a href="../mint/index.html">Mint here ‚Üí</a>
    </div>
  </div>

  <div class="customizer-wrap">

    <!-- Left: Traits -->
    <div class="trait-panel">
      <div class="trait-panel-hd">// Traits</div>

      <div class="trait-cat">
        <div class="trait-cat-hd open" onclick="toggleCat(this)">Background <span class="trait-cat-arrow">‚Ä∫</span></div>
        <div class="trait-chips open" id="cat-background"></div>
      </div>
      <div class="trait-cat">
        <div class="trait-cat-hd open" onclick="toggleCat(this)">Body <span class="trait-cat-arrow">‚Ä∫</span></div>
        <div class="trait-chips open" id="cat-body"></div>
      </div>
      <div class="trait-cat">
        <div class="trait-cat-hd open" onclick="toggleCat(this)">Head / Hat <span class="trait-cat-arrow">‚Ä∫</span></div>
        <div class="trait-chips open" id="cat-head"></div>
      </div>
      <div class="trait-cat">
        <div class="trait-cat-hd open" onclick="toggleCat(this)">Outfit <span class="trait-cat-arrow">‚Ä∫</span></div>
        <div class="trait-chips open" id="cat-outfit"></div>
      </div>
      <div class="trait-cat">
        <div class="trait-cat-hd open" onclick="toggleCat(this)">Texture <span class="trait-cat-arrow">‚Ä∫</span></div>
        <div class="trait-chips open" id="cat-texture"></div>
      </div>
      <div class="trait-cat">
        <div class="trait-cat-hd open" onclick="toggleCat(this)">Eyes <span class="trait-cat-arrow">‚Ä∫</span></div>
        <div class="trait-chips open" id="cat-eyes"></div>
      </div>
      <div class="trait-cat">
        <div class="trait-cat-hd open" onclick="toggleCat(this)">Mouth <span class="trait-cat-arrow">‚Ä∫</span></div>
        <div class="trait-chips open" id="cat-mouth"></div>
      </div>
    </div>

    <!-- Center: Canvas -->
    <div class="canvas-stage">
      <div class="canvas-box">
        <canvas id="previewCanvas" width="500" height="500"></canvas>
      </div>
      <div class="canvas-label" id="nftLabel">BHB #‚Äî</div>
    </div>

    <!-- Right: Save -->
    <div class="save-panel">
      <div class="save-panel-hd">// Current Build</div>
      <div class="save-panel-body">
        <div class="trait-summary">
          <div class="trait-row"><span class="trait-row-lbl">BG</span><span class="trait-row-val empty" id="val-background">None</span></div>
          <div class="trait-row"><span class="trait-row-lbl">Body</span><span class="trait-row-val empty" id="val-body">None</span></div>
          <div class="trait-row"><span class="trait-row-lbl">Head</span><span class="trait-row-val empty" id="val-head">None</span></div>
          <div class="trait-row"><span class="trait-row-lbl">Outfit</span><span class="trait-row-val empty" id="val-outfit">None</span></div>
          <div class="trait-row"><span class="trait-row-lbl">Texture</span><span class="trait-row-val empty" id="val-texture">None</span></div>
          <div class="trait-row"><span class="trait-row-lbl">Eyes</span><span class="trait-row-val empty" id="val-eyes">None</span></div>
          <div class="trait-row"><span class="trait-row-lbl">Mouth</span><span class="trait-row-val empty" id="val-mouth">None</span></div>
        </div>

        <button class="save-btn" id="saveBtn" disabled onclick="handleSave()">
          Save to Chain
        </button>

        <a href="../animator/index.html" class="animator-link">üé¨ Open in Animator ‚Üí</a>

        <div class="save-note">
          Saving updates your NFT's on-chain metadata. Requires a wallet signature. No SOL cost beyond network fee.
        </div>
      </div>
    </div>
  </div>
</main>

<script src="../assets/bhb.js"></script>
<script>
  const selections = { background:null, body:null, head:null, outfit:null, texture:null, eyes:null, mouth:null };
  const BASE_TRAITS = {
    background: ['Aquatic','Burst','Envious','Haunted','Lavish','Mania','Natural','Passionate','Regal','Snowflake','Sunflower','Vibes'],
    body: ['Blank','Charcoal','Dark Tone','Ghostly','Golden God','Light Tone','Mid Tone','Pinky','Tangerine','Turquoise'],
    head: ['Antenna','Beanie','Captain Hat','Cat Hat','Fancy Hat','Horny Horns','Jester','Kingly','Mohawk Blue','Mohawk Green','Mohawk Red','None','Sombrero'],
    outfit: ['Blue Tee','Hodl Black','Hodl White','Locked Up','None','Red Tee','Refined Suit','Tuxedo','Yellow Tee'],
    texture: ['Acid','Blood','Ink','Magical','None','Pulverized'],
    eyes: ['Annoyed','Blink','Curious','Dots','Grumpy','Joy','Ouchy','Paranoid','Stare','Stern','Surprised','Too Chill'],
    mouth: ['Bean Frown','Bean Smile','Bored','Eee','Ehh','Fff','LLL','Mmm','Ooo','Rrr','Simpleton','Smirk','Sss','Thh','Uhh']
  };

  function renderTraits() {
    Object.keys(BASE_TRAITS).forEach(cat => {
      const el = document.getElementById('cat-' + cat);
      if (!el) return;
      el.innerHTML = '';
      BASE_TRAITS[cat].forEach(t => {
        const chip = document.createElement('span');
        chip.className = 'trait-chip';
        chip.textContent = t;
        chip.onclick = () => select(cat, t, chip);
        el.appendChild(chip);
      });
    });
  }

  function select(cat, val, chip) {
    document.querySelectorAll(`#cat-${cat} .trait-chip`).forEach(c => c.classList.remove('selected'));
    if (selections[cat] === val) {
      selections[cat] = null;
      const el = document.getElementById('val-' + cat);
      el.textContent = 'None'; el.className = 'trait-row-val empty';
    } else {
      selections[cat] = val;
      chip.classList.add('selected');
      const el = document.getElementById('val-' + cat);
      el.textContent = val; el.className = 'trait-row-val';
    }
    updateSaveBtn();
    renderCanvas();
  }

  function toggleCat(hd) {
    hd.classList.toggle('open');
    hd.nextElementSibling.classList.toggle('open');
  }

  function renderCanvas() {
    const canvas = document.getElementById('previewCanvas');
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0,0,500,500);
    ctx.fillStyle = '#f5f0e8';
    ctx.fillRect(0,0,500,500);
    // halftone
    ctx.fillStyle = 'rgba(0,0,0,0.04)';
    for (let x=0;x<500;x+=18) for (let y=0;y<500;y+=18) { ctx.beginPath(); ctx.arc(x,y,1,0,Math.PI*2); ctx.fill(); }
    // placeholder big head
    ctx.fillStyle = '#ffe135';
    ctx.beginPath(); ctx.arc(250,220,140,0,Math.PI*2); ctx.fill();
    ctx.strokeStyle = '#0d0d0d'; ctx.lineWidth = 4;
    ctx.beginPath(); ctx.arc(250,220,140,0,Math.PI*2); ctx.stroke();
    // eyes
    ctx.fillStyle = '#0d0d0d';
    ctx.beginPath(); ctx.arc(205,200,18,0,Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(295,200,18,0,Math.PI*2); ctx.fill();
    ctx.fillStyle = '#fff';
    ctx.beginPath(); ctx.arc(210,194,7,0,Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(300,194,7,0,Math.PI*2); ctx.fill();
    // mouth
    ctx.strokeStyle = '#0d0d0d'; ctx.lineWidth = 5; ctx.lineCap = 'round';
    ctx.beginPath(); ctx.arc(250,240,45,0.15*Math.PI,0.85*Math.PI); ctx.stroke();
    // selected traits label
    const active = Object.entries(selections).filter(([,v])=>v);
    if (active.length > 0) {
      ctx.fillStyle = 'rgba(0,0,0,0.65)';
      ctx.fillRect(0,420,500,80);
      ctx.fillStyle = '#ffe135';
      ctx.font = 'bold 12px DM Mono, monospace';
      ctx.textAlign = 'center';
      active.slice(0,4).forEach(([k,v],i) => {
        ctx.fillText(`${k}: ${v}`, 250, 445 + i*16);
      });
    }
  }

  function updateSaveBtn() {
    const btn = document.getElementById('saveBtn');
    const any = Object.values(selections).some(v=>v!==null);
    btn.disabled = !any || !BHB.walletAddress;
  }

  async function handleSave() {
    BHB.toast('Save to chain ‚Äî Vercel API integration coming soon.', 'warning');
  }

  document.addEventListener('bhb:wallet-connected', () => {
    document.getElementById('gate').style.display = 'none';
    document.getElementById('nftLabel').textContent = 'BHB #001';
    updateSaveBtn();
    BHB.toast('Wallet connected! Loading your character...', 'success');
  });
  document.addEventListener('bhb:wallet-disconnected', () => {
    document.getElementById('gate').style.display = 'flex';
    updateSaveBtn();
  });

  renderTraits();
  renderCanvas();
</script>
</body>
</html>
